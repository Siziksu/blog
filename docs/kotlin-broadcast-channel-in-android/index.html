<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Siziksu&#39;s Blog &middot; Kotlin Broadcast Channel in Android</title>
    <link rel="shortcut icon" href="https://siziksu.github.io/blog/favicon.ico" />
    <link rel="canonical" href="https://siziksu.github.io/blog/kotlin-broadcast-channel-in-android/" />
    <link rel="stylesheet" type="text/css" href="https://siziksu.github.io/blog/css/main.css" />
    <link rel="stylesheet" type="text/css" href="https://siziksu.github.io/blog/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="https://siziksu.github.io/blog/css/page.css" />
    <link rel="stylesheet" type="text/css" href="https://siziksu.github.io/blog/css/pagination.css" />
    <link rel="stylesheet" type="text/css" href="https://siziksu.github.io/blog/css/single_page.css" />
    <link rel="stylesheet" type="text/css" href="https://siziksu.github.io/blog/css/single_post.css" />
    <link rel="stylesheet" type="text/css" href="https://siziksu.github.io/blog/css/list.css" />
    <link rel="stylesheet" type="text/css" href="https://siziksu.github.io/blog/css/terms.css" />
    <link rel="stylesheet" type="text/css" href="https://siziksu.github.io/blog/css/taxonomy.css" />
    <link rel="stylesheet" type="text/css" href="https://siziksu.github.io/blog/css/post_card.css" />
    <link rel="stylesheet" type="text/css" href="https://siziksu.github.io/blog/css/media.css" />
    <link rel="stylesheet" type="text/css" href="https://siziksu.github.io/blog/css/floating_header.css" />
    
  </head>
  <body>
    <header class="page floating_starter">
      <section>
      <nav class="page">
        <div>
          <ul class="nav_menu" role="menu">
          <li class="" role="menu_item"><a href="/blog/">Home</a></li>
          <li class="" role="menu_item"><a href="/blog/tags/">Tags</a></li>
          <li class="" role="menu_item"><a href="/blog/categories/">Categories</a></li>
          <li class="" role="menu_item"><a href="/blog/page/about/">About me</a></li>
          
          </ul>
        </div>
        <div>
          <div class="social_links">
            <a class="social_link" href="https://github.com/Siziksu" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
            <a class="social_link" href="https://www.linkedin.com/in/esteban-latre" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M150.65,100.682c0,27.992-22.508,50.683-50.273,50.683c-27.765,0-50.273-22.691-50.273-50.683 C50.104,72.691,72.612,50,100.377,50C128.143,50,150.65,72.691,150.65,100.682z M143.294,187.333H58.277V462h85.017V187.333z M279.195,187.333h-81.541V462h81.541c0,0,0-101.877,0-144.181c0-38.624,17.779-61.615,51.807-61.615 c31.268,0,46.289,22.071,46.289,61.615c0,39.545,0,144.181,0,144.181h84.605c0,0,0-100.344,0-173.915 s-41.689-109.131-99.934-109.131s-82.768,45.369-82.768,45.369V187.333z" /></svg></a>
            <a class="social_link" href="" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></a>
          </div>  
        </div>
      </nav>
      </section>  
    </header>
    <article class="single_post">
      <header class="single_post">
        <figure style="background-image: url(https://siziksu.github.io/blog/images/back-view-boats-couple-2612852.jpg)"></figure>
      </header>
      <section class="single_post">
        <section class="single_post_meta">
          <time class="meta_date" datetime="2019-07-14">14 July 2019</time>
          <span class="date_term_divider">|</span><a href="https://siziksu.github.io/blog/tags/broadcast/" class="term">#broadcast</a><a href="https://siziksu.github.io/blog/tags/channel/" class="term">#channel</a><a href="https://siziksu.github.io/blog/tags/kotlin/" class="term">#kotlin</a><a href="https://siziksu.github.io/blog/tags/android/" class="term">#android</a>
        </section>
        <section class="title">
          <h1>Kotlin Broadcast Channel in Android</h1>
          
        </section>


<p>Ok, so you are the kind of programmer that uses Rx not only for background tasks, but also to subscribe to events and update things via subscription to subjects.
But, now you are using coroutines and want to mimic that so&hellip; how can you do that with coroutines?</p>

<p>Well, the straight answer is <code>Broadcast Channels</code>.</p>

<blockquote>
<p>A <code>Broadcast Channel</code> is a non-blocking primitive for communication between a sender and multiple receivers that subscribe for the elements.</p>
</blockquote>

<p>In this example we are going to do a simple application with a <code>Broadcast Channel</code>, a <code>Sender</code> and two <code>Receivers</code>. For this I will try to build something as <code>real</code> as possible to end up being something more usefull that the usual stuff that you read that, when you try to implement, never works as you expected. So lets get started.</p>

<p>Also, in this example I will be using <a href="https://github.com/InsertKoinIO/koin">Koin</a> as an Injector.</p>

<blockquote>
<p>You can find the source code here: <a href="http://github.com/Siziksu/kotlin-broadcast-channel">KotlinBroadcastChannel</a>.</p>
</blockquote>

<p><br /></p>

<h2 id="the-channel">The channel</h2>

<p>First of all, we need a channel to publish in and to observe from. What we want here, is a single channel where we will be sending data to, and multiple receivers (observers) that will subscribe to and get the data from. This kind of channel is called <code>Broadcast Channel</code>.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Kotlin" data-lang="Kotlin"><span style="color:#66d9ef">val</span> channel: BroadcastChannel&lt;Int&gt; = BroadcastChannel(Channel.CONFLATED)</code></pre></div>

<blockquote>
<p>A <code>conflated channel</code> is a channel that buffers at most one element and conflates (brings together and fuse all elements into a single one) all subsequent <code>send</code> and <code>offer</code> invocations, so that the receiver always gets the most recently sent element. That means that, if you send, for instance, 5 numbers (lets say 3, 1, 54, 34, 10) and then you start observing, you will get just the last number, in this case, the 10.</p>
</blockquote>

<p>For this example I will be injecting this channel using <code>koin</code> in the folliwing way:</p>

<p><strong>ViewModule.kt</strong></p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Kotlin" data-lang="Kotlin"><span style="color:#66d9ef">val</span> viewModule = module {

    single&lt;BroadcastChannel&lt;Int&gt;&gt; { BroadcastChannel(Channel.CONFLATED) }
}</code></pre></div>

<blockquote>
<p>Notice that is a <code>single</code>, that in koin means that everytime the object is injected it will give you the same instance.</p>
</blockquote>

<p><br /></p>

<h2 id="the-publisher">The publisher</h2>

<p>Next, we want to publish (send) values to the channel. For this we need to launch a new coroutine without blocking the thread, like this:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Kotlin" data-lang="Kotlin">GlobalScope.launch { channel.send(<span style="color:#ae81ff">1</span>) }</code></pre></div>

<p>Here we are sending the number <code>1</code> to the channel.</p>

<blockquote>
<p>The channel used here is the one that we are injecting.</p>
</blockquote>

<p>To be able to send different values when we push a button, we can create a class called <code>ChannelPlublisher</code> like this:</p>

<p><strong>ChannelPublisher.kt</strong></p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Kotlin" data-lang="Kotlin"><span style="color:#66d9ef">import</span> kotlinx.coroutines.GlobalScope
<span style="color:#66d9ef">import</span> kotlinx.coroutines.channels.BroadcastChannel
<span style="color:#66d9ef">import</span> kotlinx.coroutines.launch
<span style="color:#66d9ef">import</span> org.koin.standalone.StandAloneContext

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChannelPublisher</span> {

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> channel: BroadcastChannel&lt;Int&gt; = StandAloneContext.getKoin().koinContext.<span style="color:#66d9ef">get</span>()

    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">publish</span>(element: Int) {
        GlobalScope.launch { channel.send(element) }
    }
}</code></pre></div>

<p>I will inject this class with koin so, at this moment, the koin module will be:</p>

<p><strong>ViewModule.kt</strong></p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Kotlin" data-lang="Kotlin"><span style="color:#66d9ef">val</span> viewModule = module {

    single&lt;BroadcastChannel&lt;Int&gt;&gt; { BroadcastChannel(Channel.CONFLATED) }
    single { ChannelPublisher() }
}</code></pre></div>

<p>We will be injecting it in this case in the <code>MainActivity</code> through the line <code>private val channelPublisher: ChannelPublisher by inject()</code>. To effectively use it, we will have the field <code>private var number = 0</code> and a button, and we will update the values doing something like this: <code>button.setOnClickListener { channelPublisher.publish(++number) }</code>.</p>

<p><strong>MainActivity.kt</strong></p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Kotlin" data-lang="Kotlin"><span style="color:#66d9ef">import</span> android.os.Bundle
<span style="color:#66d9ef">import</span> androidx.appcompat.app.AppCompatActivity
<span style="color:#66d9ef">import</span> com.siziksu.ui.R
<span style="color:#66d9ef">import</span> com.siziksu.ui.common.channel.ChannelPublisher
<span style="color:#66d9ef">import</span> kotlinx.android.synthetic.main.activity_main.mainAddButton
<span style="color:#66d9ef">import</span> org.koin.android.ext.android.inject

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MainActivity</span> : AppCompatActivity() {

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> channelPublisher: ChannelPublisher <span style="color:#66d9ef">by</span> inject()
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> number = <span style="color:#ae81ff">0</span>

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onCreate</span>(savedInstanceState: Bundle?) {
        <span style="color:#66d9ef">super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        initializeViews()
    }

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">initializeViews</span>() {
        channelPublisher.publish(++number)
        mainAddButton.setOnClickListener { channelPublisher.publish(++number) }
    }
}</code></pre></div>

<p><br /></p>

<h2 id="the-observers">The observers</h2>

<p>Now, it&rsquo;s time to get the values from the observers, in this case, the two fragments. To observe the channel, we need to create a coroutine and listen to the channel values like this:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Kotlin" data-lang="Kotlin">GlobalScope.launch { channel.consumeEach { print(it) } }</code></pre></div>

<p>And like we did before, we will create the class <code>ChannelObserver</code> to simplify the use and manipulation of the channel.</p>

<p><strong>ChannelObserver.kt</strong></p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Kotlin" data-lang="Kotlin"><span style="color:#66d9ef">import</span> kotlinx.coroutines.CompletableJob
<span style="color:#66d9ef">import</span> kotlinx.coroutines.Dispatchers
<span style="color:#66d9ef">import</span> kotlinx.coroutines.GlobalScope
<span style="color:#66d9ef">import</span> kotlinx.coroutines.Job
<span style="color:#66d9ef">import</span> kotlinx.coroutines.channels.BroadcastChannel
<span style="color:#66d9ef">import</span> kotlinx.coroutines.channels.consumeEach
<span style="color:#66d9ef">import</span> kotlinx.coroutines.launch
<span style="color:#66d9ef">import</span> org.koin.standalone.StandAloneContext

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChannelObserver</span> {

    <span style="color:#66d9ef">var</span> pause = <span style="color:#66d9ef">false</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> channel: BroadcastChannel&lt;Int&gt; = StandAloneContext.getKoin().koinContext.<span style="color:#66d9ef">get</span>()
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> job: CompletableJob = Job()

    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onReceive</span>(func: ((Int) -&gt; Unit)) {
        GlobalScope.launch(Dispatchers.Main + job) { channel.consumeEach { <span style="color:#66d9ef">if</span> (!pause) func(it) } }
    }

    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">unsubscribe</span>() {
        job.cancel()
    }
}</code></pre></div>

<blockquote>
<p>Notice here that I implemented a way to be able to pause the subscription. This comes handy when, for instance, you go to background and you don&rsquo;t need/want to observe while in this state.</p>
</blockquote>

<p>Of course we will also inject this class, so the koin module at this point will be:</p>

<p><strong>ViewModule.kt</strong></p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Kotlin" data-lang="Kotlin"><span style="color:#66d9ef">val</span> viewModule = module {

    single&lt;BroadcastChannel&lt;Int&gt;&gt; { BroadcastChannel(Channel.CONFLATED) }
    single { ChannelPublisher() }
    factory { ChannelObserver() }
}</code></pre></div>

<blockquote>
<p>Notice that in this case the Observers are <code>factory</code>, that in koin means that everytime the object is injected it will give you a new instance.</p>
</blockquote>

<p>So now, we can implement this in the observers (our fragments).</p>

<p><strong>PrimaryFragment.kt</strong></p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Kotlin" data-lang="Kotlin"><span style="color:#66d9ef">import</span> android.os.Bundle
<span style="color:#66d9ef">import</span> android.view.LayoutInflater
<span style="color:#66d9ef">import</span> android.view.View
<span style="color:#66d9ef">import</span> android.view.ViewGroup
<span style="color:#66d9ef">import</span> androidx.appcompat.app.AppCompatActivity
<span style="color:#66d9ef">import</span> androidx.fragment.app.Fragment
<span style="color:#66d9ef">import</span> androidx.navigation.fragment.findNavController
<span style="color:#66d9ef">import</span> com.siziksu.ui.R
<span style="color:#66d9ef">import</span> com.siziksu.ui.common.channel.ChannelObserver
<span style="color:#66d9ef">import</span> kotlinx.android.synthetic.main.fragment_primary.primaryButton
<span style="color:#66d9ef">import</span> kotlinx.android.synthetic.main.fragment_primary.primaryValue
<span style="color:#66d9ef">import</span> kotlinx.android.synthetic.main.toolbar.toolbar
<span style="color:#66d9ef">import</span> org.koin.android.ext.android.getKoin

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PrimaryFragment</span> : Fragment() {

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">lateinit</span> <span style="color:#66d9ef">var</span> channelObserver: ChannelObserver

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onCreateView</span>(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View? {
        channelObserver = getKoin().<span style="color:#66d9ef">get</span>()
        <span style="color:#66d9ef">return</span> inflater.inflate(R.layout.fragment_primary, container, <span style="color:#66d9ef">false</span>)
    }

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onViewCreated</span>(view: View, savedInstanceState: Bundle?) {
        <span style="color:#66d9ef">super</span>.onViewCreated(view, savedInstanceState)
        initViews()
    }

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onResume</span>() {
        <span style="color:#66d9ef">super</span>.onResume()
        channelObserver.pause = <span style="color:#66d9ef">false</span>
    }

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onPause</span>() {
        <span style="color:#66d9ef">super</span>.onPause()
        channelObserver.pause = <span style="color:#66d9ef">true</span>
    }

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onDestroy</span>() {
        <span style="color:#66d9ef">super</span>.onDestroy()
        channelObserver.unsubscribe()
    }

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">initViews</span>() {
        activity<span style="color:#f92672">?.</span>let { (activity <span style="color:#66d9ef">as</span> AppCompatActivity).setSupportActionBar(toolbar) }
        primaryButton.setOnClickListener { findNavController().navigate(PrimaryFragmentDirections.toSecondary()) }
        channelObserver.onReceive { primaryValue.text = getString(R.string.value, it) }
    }
}</code></pre></div>

<p><strong>SecondaryFragment.kt</strong></p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Kotlin" data-lang="Kotlin"><span style="color:#66d9ef">import</span> android.os.Bundle
<span style="color:#66d9ef">import</span> android.view.LayoutInflater
<span style="color:#66d9ef">import</span> android.view.View
<span style="color:#66d9ef">import</span> android.view.ViewGroup
<span style="color:#66d9ef">import</span> androidx.appcompat.app.AppCompatActivity
<span style="color:#66d9ef">import</span> androidx.fragment.app.Fragment
<span style="color:#66d9ef">import</span> com.siziksu.ui.R
<span style="color:#66d9ef">import</span> com.siziksu.ui.common.channel.ChannelObserver
<span style="color:#66d9ef">import</span> kotlinx.android.synthetic.main.fragment_secondary.secondaryButton
<span style="color:#66d9ef">import</span> kotlinx.android.synthetic.main.fragment_secondary.secondaryValue
<span style="color:#66d9ef">import</span> kotlinx.android.synthetic.main.toolbar.toolbar
<span style="color:#66d9ef">import</span> org.koin.android.ext.android.getKoin

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecondaryFragment</span> : Fragment() {

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">lateinit</span> <span style="color:#66d9ef">var</span> channelObserver: ChannelObserver

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onCreateView</span>(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View? {
        channelObserver = getKoin().<span style="color:#66d9ef">get</span>()
        <span style="color:#66d9ef">return</span> inflater.inflate(R.layout.fragment_secondary, container, <span style="color:#66d9ef">false</span>)
    }

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onViewCreated</span>(view: View, savedInstanceState: Bundle?) {
        <span style="color:#66d9ef">super</span>.onViewCreated(view, savedInstanceState)
        initViews()
    }

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onDestroy</span>() {
        <span style="color:#66d9ef">super</span>.onDestroy()
        channelObserver.unsubscribe()
    }

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">initViews</span>() {
        activity<span style="color:#f92672">?.</span>let { (activity <span style="color:#66d9ef">as</span> AppCompatActivity).setSupportActionBar(toolbar) }
        secondaryButton.setOnClickListener { activity<span style="color:#f92672">?.</span>onBackPressed() }
        channelObserver.onReceive { secondaryValue.text = getString(R.string.value, it) }
    }
}</code></pre></div>

<p><br /></p>

<p>And that&rsquo;s it!</p>

      </section>
      <footer class="single_post">
          <section class="author">
            <img class="author-image" src="https://siziksu.github.io/blog/images/profile_picture.png" alt="Author" />
            <section>
              <p class="author-name">Esteban Latre</p>
              <p class="author-description">Android Developer. Kotlin and Linux enthusiast.</p>
            </section>
          </section>
      </footer>
      <section class="disqus">
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "siziksu-blog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </section>
      <aside class="read_next">

        <section class="post_card" style="background-image: url(https://siziksu.github.io/blog/images/architecture-bridge-buildings-2129814.jpg);" >
          <div class="random_next">
            <header>
              <h1> Siziksu&#39;s Blog</h1>
            </header>
            <div class="divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg></div>
            <div class="shuffle_posts">
              <ul>
              <li><a href="https://siziksu.github.io/blog/how-to-create-a-desktop-file-in-linux/">How to Create a Desktop File in Linux</a></li>
              <li><a href="https://siziksu.github.io/blog/linux-locations/">Linux locations</a></li>
              <li><a href="https://siziksu.github.io/blog/welcome-post/">Welcome post</a></li>
              <li><a href="https://siziksu.github.io/blog/linux-apt-commands/">Linux &#39;apt&#39; commands</a></li></ul>
            </div>
            <footer>
                <a href="https://siziksu.github.io/blog/tags/broadcast/">See all related posts →</a>
            </footer>
          </div>
        </section>

        
        <section class="post_card">
          
          <a class="post_card_image_link" href="https://siziksu.github.io/blog/docker-with-node.js-and-mongodb-using-nodemon-express-morgan-and-mongoose/">
            <div class="post_card_image" style="background-image: url(https://siziksu.github.io/blog/images/beverage-business-classic-2305765.jpg)"></div>
          </a>
          
          <div class="post_card_content">
            <a class="post_card_content_link" href="https://siziksu.github.io/blog/docker-with-node.js-and-mongodb-using-nodemon-express-morgan-and-mongoose/">
              <header class="post_card_header">
                
                <span class="post_card_tags"> #node #express #morgan #mongoose #mongo</span>
                
                <h1 class="post_card_title">Docker with Node.js and MongoDB (using Nodemon, Express, Morgan and Mongoose)</h1>
              </header>
              <section class="post_card_excerpt">
                
                <p>This post will explain how to use docker-compose to create the environment to use Node.js and MongoDB with Docker.</p>
                
              </section>
              <p class="date">Date: 24 June 2019</p>
              
            </a>
            <footer class="post_card_meta">
              <img class="author_profile_image" src="https://siziksu.github.io/blog/images/profile_picture.png" alt="Author" />
              <span class="post_card_author">Esteban Latre</span>
            </footer>
          </div>
        </section>

        
        
      </aside>
    </article>
    <section class="floating-header">
      <div class="floating-header-logo">
        <a href="https://siziksu.github.io/">
          
          <span>Siziksu&#39;s Blog</span>
        </a>
      </div>
      <span class="floating-header-divider">&mdash;</span>
      <div class="floating-header-title">Kotlin Broadcast Channel in Android</div>
      <div class="floating-header-share">
        <div class="floating-header-share-label">Share <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/></svg>
        </div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Kotlin%20Broadcast%20Channel%20in%20Android&amp;url=https%3a%2f%2fsiziksu.github.io%2fblog%2fkotlin-broadcast-channel-in-android%2f" onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
          </a>
          <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fsiziksu.github.io%2fblog%2fkotlin-broadcast-channel-in-android%2f" onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
          </a>
      </div>
      <progress class="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </section>
    <footer class="page">
      <section>
        <p>Esteban Latre © 2019</p>
        <nav>
          <a href="/blog/">Latest Posts</a>
          <a href="https://github.com/Siziksu" target="_blank" rel="noopener">Github</a>
          <a href="https://www.linkedin.com/in/esteban-latre" target="_blank" rel="noopener">LinkedIn</a>
        </nav>
      </section> 
    </footer>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/highlight.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="https://siziksu.github.io/blog/js/jquery.fitvids.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <script>
      $(document).ready(function () {
        var $postContent = $(".single_post");
        $postContent.fitVids();

        var progressBar = document.querySelector('progress');
        var header = document.querySelector('.floating-header');
        var title = document.querySelector('.floating_starter');

        var lastScrollY = window.scrollY;
        var lastWindowHeight = window.innerHeight;
        var lastDocumentHeight = $(document).height();
        var ticking = false;

        function onScroll() {
            lastScrollY = window.scrollY;
            requestTick();
        }

        function onResize() {
            lastWindowHeight = window.innerHeight;
            lastDocumentHeight = $(document).height();
            requestTick();
        }

        function requestTick() {
            if (!ticking) {
                requestAnimationFrame(update);
            }
            ticking = true;
        }

        function update() {
            var trigger = title.getBoundingClientRect().top + window.scrollY;
            var triggerOffset = title.offsetHeight + 35;
            var progressMax = lastDocumentHeight - lastWindowHeight;

            
            if (lastScrollY >= trigger + triggerOffset) {
                header.classList.add('floating-active');
            } else {
                header.classList.remove('floating-active');
            }

            progressBar.setAttribute('max', progressMax);
            progressBar.setAttribute('value', lastScrollY);

            ticking = false;
        }

        window.addEventListener('scroll', onScroll, {passive: true});
        window.addEventListener('resize', onResize, false);

        update();
      });
    </script>
  </body>
</html>